.GlitchEffect {
  position: relative;
  display: inline-block;
  animation: glitch-luminosity 2.5s var(--glitch-delay, 0s) infinite;
}

.GlitchEffect::before,
.GlitchEffect::after {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  background: inherit;
  mix-blend-mode: screen;
}

.GlitchEffect::before {
  animation: glitch-rgb-flare-red 4s
    calc(var(--glitch-delay, 0s) + var(--glitch-delay-before, 0s)) infinite;
  box-shadow: -3px 0 0 oklch(65% 0.35 25 / 0.5);
}

.GlitchEffect::after {
  animation: glitch-rgb-flare-cyan 4s
    calc(var(--glitch-delay, 0s) + var(--glitch-delay-after, 0s)) infinite;
  box-shadow: 3px 0 0 oklch(65% 0.3 220 / 0.5);
}

/* Scanlines overlay */
.GlitchEffect--scanlines {
  background:
    /* Sweeping bright line */
    linear-gradient(
      to bottom,
      transparent 0%,
      oklch(100% 0 0 / 0) 45%,
      oklch(100% 0 0 / 0.12) 49%,
      oklch(100% 0 0 / 0.2) 50%,
      oklch(100% 0 0 / 0.12) 51%,
      oklch(100% 0 0 / 0) 55%,
      transparent 100%
    ),
    /* Static scanlines pattern */
    repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        oklch(0% 0 0 / 0.03) 2px,
        oklch(0% 0 0 / 0.03) 4px
      );
  background-size:
    100% 300%,
    100% 100%;
  animation:
    glitch-luminosity 2.5s var(--glitch-delay, 0s) infinite,
    glitch-scanline-sweep 4s linear infinite;
}

/* Keyframes */

/* Scanline sweep */
@keyframes glitch-scanline-sweep {
  0% {
    background-position:
      0 -100%,
      0 0;
  }
  100% {
    background-position:
      0 200%,
      0 0;
  }
}

/* CRT luminosity flicker */
@keyframes glitch-luminosity {
  0% {
    opacity: 1;
    filter: none;
  }
  4% {
    opacity: 0.9;
    filter: brightness(1.08) contrast(1.04);
  }
  6% {
    opacity: 1;
    filter: none;
  }
  11% {
    opacity: 0.88;
    filter: brightness(1.1) contrast(1.05);
  }
  13% {
    opacity: 1;
    filter: none;
  }
  19% {
    opacity: 0.92;
    filter: brightness(1.06);
  }
  21% {
    opacity: 1;
    filter: none;
  }
  28% {
    opacity: 0.86;
    filter: brightness(1.12) contrast(1.06);
  }
  30% {
    opacity: 1;
    filter: none;
  }
  38% {
    opacity: 0.91;
    filter: brightness(1.07);
  }
  40% {
    opacity: 1;
    filter: none;
  }
  48% {
    opacity: 0.87;
    filter: brightness(1.1) contrast(1.05);
  }
  50% {
    opacity: 1;
    filter: none;
  }
  59% {
    opacity: 0.9;
    filter: brightness(1.08);
  }
  61% {
    opacity: 1;
    filter: none;
  }
  69% {
    opacity: 0.85;
    filter: brightness(1.12) contrast(1.06);
  }
  71% {
    opacity: 1;
    filter: none;
  }
  79% {
    opacity: 0.89;
    filter: brightness(1.09) contrast(1.04);
  }
  81% {
    opacity: 1;
    filter: none;
  }
  90% {
    opacity: 0.91;
    filter: brightness(1.07);
  }
  92% {
    opacity: 1;
    filter: none;
  }
  100% {
    opacity: 1;
    filter: none;
  }
}

/* RGB flare - red channel */
@keyframes glitch-rgb-flare-red {
  0%,
  100% {
    opacity: 0.25;
    box-shadow: -3px 0 0 oklch(65% 0.35 25 / 0.5);
  }
  14% {
    opacity: 0.25;
  }
  15% {
    opacity: 0.9;
    box-shadow:
      -5px 0 0 oklch(70% 0.45 25 / 0.95),
      -10px 0 0 oklch(70% 0.4 140 / 0.7),
      -14px 0 0 oklch(65% 0.35 260 / 0.5);
  }
  17% {
    opacity: 0.55;
  }
  19% {
    opacity: 0.25;
    box-shadow: -3px 0 0 oklch(65% 0.35 25 / 0.5);
  }
  54% {
    opacity: 0.25;
  }
  55% {
    opacity: 0.85;
    box-shadow:
      -4px 0 0 oklch(70% 0.45 25 / 0.9),
      -9px 0 0 oklch(70% 0.4 140 / 0.7),
      -13px 0 0 oklch(65% 0.35 260 / 0.5);
  }
  58% {
    opacity: 0.25;
    box-shadow: -3px 0 0 oklch(65% 0.35 25 / 0.5);
  }
}

/* RGB flare - cyan channel */
@keyframes glitch-rgb-flare-cyan {
  0%,
  100% {
    opacity: 0.25;
    box-shadow: 3px 0 0 oklch(65% 0.3 220 / 0.5);
  }
  15% {
    opacity: 0.25;
  }
  16% {
    opacity: 0.9;
    box-shadow:
      5px 0 0 oklch(70% 0.45 220 / 0.95),
      10px 0 0 oklch(65% 0.4 280 / 0.7),
      14px 0 0 oklch(70% 0.35 25 / 0.5);
  }
  18% {
    opacity: 0.45;
  }
  20% {
    opacity: 0.25;
    box-shadow: 3px 0 0 oklch(65% 0.3 220 / 0.5);
  }
  55% {
    opacity: 0.25;
  }
  56% {
    opacity: 0.85;
    box-shadow:
      4px 0 0 oklch(70% 0.45 220 / 0.9),
      9px 0 0 oklch(65% 0.4 280 / 0.7),
      13px 0 0 oklch(70% 0.35 25 / 0.5);
  }
  59% {
    opacity: 0.25;
    box-shadow: 3px 0 0 oklch(65% 0.3 220 / 0.5);
  }
}

/* Respect reduced motion preference */
@media (prefers-reduced-motion: reduce) {
  .GlitchEffect,
  .GlitchEffect::before,
  .GlitchEffect::after {
    animation: none;
  }
}
